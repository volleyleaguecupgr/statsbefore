<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1920, height=1080">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 1920px;
            height: 1080px;
            background: transparent;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .volleyball-3d-scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 1920px;
            height: 1080px;
            z-index: 1;
            pointer-events: none;
        }

        .moving-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 1920px;
            height: 1080px;
            overflow: hidden;
            z-index: 2;
            pointer-events: none;
        }

        .line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, rgba(59,130,246,0.4) 20%, rgba(147,197,253,0.6) 50%, rgba(59,130,246,0.4) 80%, transparent 100%);
            border-radius: 2px;
            box-shadow: 0 0 15px rgba(59,130,246,0.3);
        }

        .line-1 { width: 400px; top: 15%; animation: moveLine1 12s linear infinite; }
        .line-2 { width: 350px; top: 35%; animation: moveLine2 10s linear infinite; }
        .line-3 { width: 500px; top: 55%; animation: moveLine3 14s linear infinite; }
        .line-4 { width: 300px; top: 75%; animation: moveLine4 11s linear infinite; }
        .line-5 { width: 450px; top: 25%; animation: moveLine5 9s linear infinite; }

        @keyframes moveLine1 {
            0% { left: -400px; opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { left: 1920px; opacity: 0; }
        }

        @keyframes moveLine2 {
            0% { right: -350px; opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { right: 1920px; opacity: 0; }
        }

        @keyframes moveLine3 {
            0% { left: -500px; opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { left: 1920px; opacity: 0; }
        }

        @keyframes moveLine4 {
            0% { right: -300px; opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { right: 1920px; opacity: 0; }
        }

        @keyframes moveLine5 {
            0% { right: -450px; opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { right: 1920px; opacity: 0; }
        }

        .container {
            width: 1700px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 50px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            position: relative;
            z-index: 10;
            opacity: 0;
            transform: scale(0.3) translateY(100px);
            animation: popUpCard 1.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes popUpCard {
            0% {
                opacity: 0;
                transform: scale(0.3) translateY(100px);
                filter: blur(10px);
            }
            60% {
                transform: scale(1.05) translateY(-10px);
            }
            80% {
                transform: scale(0.98) translateY(5px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
                filter: blur(0);
            }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            opacity: 0;
            animation: fadeInSlide 0.8s ease-out 0.6s forwards;
        }

        @keyframes fadeInSlide {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .team-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .team-logo {
            width: 120px;
            height: 120px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .team-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .team-name {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .vs-section {
            font-size: 48px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .stats-grid {
            display: grid;
            gap: 15px;
        }

        .stat-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 15px;
            align-items: center;
        }

        .stat-cell {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: currentColor;
        }

        .stat-value {
            font-size: 42px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 10px rgba(255, 255, 255, 0.3);
        }

        .stat-label {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px 30px;
            text-align: center;
        }

        .stat-label-text {
            font-size: 28px;
            font-weight: 600;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.3;
        }

        .stat-label-subtext {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff006e, #8338ec);
            border-radius: 10px;
            transition: width 1s ease;
        }

        .home-highlight .stat-cell::before {
            color: var(--home-color, #00d4ff);
        }

        .away-highlight .stat-cell::before {
            color: var(--away-color, #ff006e);
        }
    </style>
</head>
<body>
    <div class="volleyball-3d-scene" id="volleyball-3d-scene"></div>
    
    <div class="moving-lines">
        <div class="line line-1"></div>
        <div class="line line-2"></div>
        <div class="line line-3"></div>
        <div class="line line-4"></div>
        <div class="line line-5"></div>
    </div>

    <div class="container">
        <div class="header">
            <div class="team-section">
                <div class="team-logo">
                    <img id="homeLogo" src="" alt="Home Team">
                </div>
                <div class="team-name" id="homeTeam"></div>
            </div>
            <div class="vs-section">VS</div>
            <div class="team-section">
                <div class="team-name" id="awayTeam"></div>
                <div class="team-logo">
                    <img id="awayLogo" src="" alt="Away Team">
                </div>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // 3D Volleyball Animation
        let scene, camera, renderer, volleyballs = [];
        let animationId;

        function init3D() {
            const container = document.getElementById('volleyball-3d-scene');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 1920 / 1080, 0.1, 1000);
            camera.position.set(0, 0, 15);
            
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(1920, 1080);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            createFlyingVolleyballs();
            animate3D();
        }

        function createVolleyball() {
            const volleyballGeometry = new THREE.SphereGeometry(2, 64, 64);
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 1024;
            const ctx = canvas.getContext('2d');
            
            const centerX = 512;
            const centerY = 512;
            
            ctx.fillStyle = '#1e3a8a';
            ctx.fillRect(0, 0, 1024, 1024);
            ctx.fillStyle = '#fbbf24';
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 400, -Math.PI/2, 0);
            ctx.lineTo(centerX, centerY);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 400, Math.PI/2, Math.PI);
            ctx.lineTo(centerX, centerY);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 400, Math.PI, 3*Math.PI/2);
            ctx.lineTo(centerX, centerY);
            ctx.fill();
            
            ctx.strokeStyle = '#1a1a1a';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 350, 0.3, Math.PI - 0.3);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, 350, Math.PI + 0.3, 2 * Math.PI - 0.3);
            ctx.stroke();
            
            const volleyballTexture = new THREE.CanvasTexture(canvas);
            const volleyballMaterial = new THREE.MeshPhongMaterial({
                map: volleyballTexture,
                shininess: 25,
                specular: new THREE.Color(0x333333)
            });
            
            const volleyball = new THREE.Mesh(volleyballGeometry, volleyballMaterial);
            volleyball.castShadow = true;
            volleyball.receiveShadow = true;
            
            return volleyball;
        }

        function createFlyingVolleyballs() {
            for (let i = 0; i < 3; i++) {
                const volleyball = createVolleyball();
                volleyball.userData = {
                    speed: 0.8 + i * 0.3,
                    yOffset: (i - 1) * 8,
                    phase: i * Math.PI * 0.66,
                    direction: i % 2 === 0 ? 1 : -1
                };
                
                volleyball.position.set(
                    volleyball.userData.direction === 1 ? -25 : 25, 
                    volleyball.userData.yOffset, 
                    -5 + i * 2
                );
                
                volleyball.scale.set(0.8 + i * 0.1, 0.8 + i * 0.1, 0.8 + i * 0.1);
                volleyballs.push(volleyball);
                scene.add(volleyball);
            }
        }

        function animate3D() {
            animationId = requestAnimationFrame(animate3D);
            const time = Date.now() * 0.001;
            
            volleyballs.forEach((volleyball, index) => {
                const userData = volleyball.userData;
                const progress = (time * userData.speed + userData.phase) % (Math.PI * 2);
                const normalizedProgress = (Math.sin(progress) + 1) / 2;
                
                if (userData.direction === 1) {
                    const x = -25 + normalizedProgress * 50;
                    const y = userData.yOffset + Math.sin(normalizedProgress * Math.PI) * 6;
                    volleyball.position.set(x, y, volleyball.position.z);
                } else {
                    const x = 25 - normalizedProgress * 50;
                    const y = userData.yOffset + Math.sin(normalizedProgress * Math.PI) * 6;
                    volleyball.position.set(x, y, volleyball.position.z);
                }
                
                volleyball.rotation.x += 0.02 * userData.speed;
                volleyball.rotation.y += 0.015 * userData.speed;
                
                const scale = 0.8 + index * 0.1 + Math.sin(time * 2 + index) * 0.1;
                volleyball.scale.set(scale, scale, scale);
            });
            
            renderer.render(scene, camera);
        }

        // Data loading
        // Team data with colors
        const teamData = {
            "kalamata": {
                name: "AO KALAMATA '80",
                logo: "logos/kalamata.png",
                color: "#FFD700"
            },
            "panathinaikos": {
                name: "PANATHINAIKOS A.O.",
                logo: "logos/panathinaikos.png",
                color: "#00A651"
            },
            "kifisia": {
                name: "AOP KIFISIAS",
                logo: "logos/kifisia.png",
                color: "#0066CC"
            },
            "olympiakos": {
                name: "OLYMPIACOS S.F.P.",
                logo: "logos/olympiakos.png",
                color: "#ED1C24"
            },
            "ofi": {
                name: "O.F.I.",
                logo: "logos/ofi.png",
                color: "#E30613"
            },
            "paok": {
                name: "PAOK",
                logo: "logos/paok.png",
                color: "#000000"
            },
            "milon": {
                name: "AONS MILON",
                logo: "logos/milon.png",
                color: "#0047AB"
            },
            "panionios": {
                name: "PANIONIOS G.S.S.",
                logo: "logos/panionios.png",
                color: "#0047AB"
            },
            "foinikas": {
                name: "A.O. FOINIKAS SIROU",
                logo: "logos/foinikas.png",
                color: "#FF6600"
            },
            "floisvos": {
                name: "AO FLOISVOS",
                logo: "logos/floisvos.png",
                color: "#1E90FF"
            }
        };

        // Get team name from URL parameter
        function getTeamFromURL() {
            // First, check for ?team= parameter
            const urlParams = new URLSearchParams(window.location.search);
            const teamParam = urlParams.get('team');
            
            if (teamParam) {
                console.log('Team from query parameter:', teamParam);
                return teamParam.toLowerCase();
            }
            
            // Check if team is in the path (e.g., /statsbefore/floisvos)
            const pathParts = window.location.pathname.split('/').filter(part => part !== '');
            console.log('Path parts:', pathParts);
            
            // Get the last part of the path
            const lastPart = pathParts[pathParts.length - 1];
            
            // Remove .html extension if present
            const teamName = lastPart ? lastPart.replace('.html', '').toLowerCase() : '';
            
            console.log('Extracted team name:', teamName);
            
            // Check if it's a valid team
            if (teamName && teamName in teamData) {
                return teamName;
            }
            
            // Default fallback
            console.warn('No valid team found in URL, using default: floisvos');
            return 'floisvos';
        }

        // Configuration: determine JSON file path based on URL
        const TEAM_NAME = getTeamFromURL();
        const JSON_FILE_PATH = `${TEAM_NAME}.json`;
        
        console.log('Loading JSON file:', JSON_FILE_PATH);

        let data = null;
        let homeTeamColor = '#00d4ff';
        let awayTeamColor = '#ff006e';

        async function loadJSON() {
            try {
                const response = await fetch(JSON_FILE_PATH);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                data = await response.json();
                
                // Set team colors based on loaded data
                const homeTeamName = data.match_info.home_team;
                const awayTeamName = data.match_info.away_team;
                
                // Find team keys by matching names
                const homeTeamKey = Object.keys(teamData).find(key => 
                    teamData[key].name === homeTeamName
                );
                const awayTeamKey = Object.keys(teamData).find(key => 
                    teamData[key].name === awayTeamName
                );
                
                if (homeTeamKey) homeTeamColor = teamData[homeTeamKey].color;
                if (awayTeamKey) awayTeamColor = teamData[awayTeamKey].color;
                
                // Set CSS custom properties for team colors
                document.documentElement.style.setProperty('--home-color', homeTeamColor);
                document.documentElement.style.setProperty('--away-color', awayTeamColor);
                
                initializeCard();
            } catch (error) {
                console.error('Error loading JSON:', error);
                document.querySelector('.container').innerHTML = `
                    <div style="color: #fff; text-align: center; padding: 50px;">
                        <h1>Error Loading Data</h1>
                        <p>Please make sure ${JSON_FILE_PATH} exists.</p>
                        <p style="color: #ff6b6b; margin-top: 20px;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        function loadTeamInfo() {
            const homeTeam = data.match_info.home_team;
            const awayTeam = data.match_info.away_team;

            document.getElementById('homeTeam').textContent = homeTeam;
            document.getElementById('awayTeam').textContent = awayTeam;
            
            // Find team data by name
            const homeTeamKey = Object.keys(teamData).find(key => 
                teamData[key].name === homeTeam
            );
            const awayTeamKey = Object.keys(teamData).find(key => 
                teamData[key].name === awayTeam
            );
            
            document.getElementById('homeLogo').src = homeTeamKey ? teamData[homeTeamKey].logo : '';
            document.getElementById('awayLogo').src = awayTeamKey ? teamData[awayTeamKey].logo : '';
        }

        function createStatRow(homeValue, label, awayValue, subtext = '') {
            const row = document.createElement('div');
            row.className = 'stat-row';

            row.innerHTML = `
                <div class="stat-cell home-highlight">
                    <div class="stat-value">${homeValue}</div>
                </div>
                <div class="stat-label">
                    <div class="stat-label-text">${label}</div>
                    ${subtext ? `<div class="stat-label-subtext">${subtext}</div>` : ''}
                </div>
                <div class="stat-cell away-highlight">
                    <div class="stat-value">${awayValue}</div>
                </div>
            `;

            return row;
        }

        function loadStats() {
            const grid = document.getElementById('statsGrid');
            const stats = data.teams_comparison;

            // Clear existing stats
            grid.innerHTML = '';

            const statRows = [];

            // Spike Efficiency
            statRows.push(createStatRow(
                stats.spikes.efficiency.home,
                'SPIKE EFFICIENCY',
                stats.spikes.efficiency.away
            ));

            // Spikes per Set
            statRows.push(createStatRow(
                `${stats.spikes.spikes_per_set_home} ${stats.spikes.spikes_per_set_home_played}`,
                'SPIKES PER SET',
                `${stats.spikes.spikes_per_set_away} ${stats.spikes.spikes_per_set_away_played}`
            ));

            // Blocks per Set
            statRows.push(createStatRow(
                `${stats.blocks.blocks_per_set_home} ${stats.blocks.blocks_home_played}`,
                'BLOCKS PER SET',
                `${stats.blocks.blocks_per_set_away} ${stats.blocks.blocks_away_played}`
            ));

            // Aces Scored
            statRows.push(createStatRow(
                stats.serve.aces_home,
                'ACES SCORED',
                stats.serve.aces_away
            ));

            // Aces per Set
            statRows.push(createStatRow(
                `${stats.serve.aces_per_set_home} ${stats.serve.aces_home_played}`,
                'ACES PER SET',
                `${stats.serve.aces_per_set_away} ${stats.serve.aces_away_played}`
            ));

            // Reception Efficiency
            statRows.push(createStatRow(
                stats.reception.reception_eff_home,
                'RECEPTION EFFICIENCY',
                stats.reception.reception_eff_away
            ));

            // Reception Perfect
            statRows.push(createStatRow(
                stats.reception.reception_perfect_home,
                'RECEPTION PERFECT',
                stats.reception.reception_perfect_away
            ));

            // Add rows with staggered animation
            statRows.forEach((row, index) => {
                grid.appendChild(row);
                setTimeout(() => {
                    row.classList.add('animate-in');
                }, 1000 + (index * 100));
            });
        }

        function initializeCard() {
            loadTeamInfo();
            loadStats();
        }

        // Restart animations when page is shown (e.g., OBS source becomes visible)
        function restartAnimations() {
            const container = document.querySelector('.container');
            const header = document.querySelector('.header');
            const rows = document.querySelectorAll('.stat-row');
            
            // Remove and re-add animation classes to restart
            container.style.animation = 'none';
            header.style.animation = 'none';
            rows.forEach(row => row.style.animation = 'none');
            
            // Force reflow
            void container.offsetWidth;
            
            // Re-apply animations
            container.style.animation = '';
            header.style.animation = '';
            rows.forEach((row, index) => {
                row.classList.remove('animate-in');
                setTimeout(() => {
                    row.classList.add('animate-in');
                }, 1000 + (index * 100));
            });
        }

        // Auto-reload the JSON every 5 seconds to pick up changes
        function startAutoReload() {
            setInterval(async () => {
                try {
                    const response = await fetch(JSON_FILE_PATH + '?t=' + Date.now());
                    if (response.ok) {
                        const newData = await response.json();
                        // Check if data has actually changed
                        if (JSON.stringify(newData) !== JSON.stringify(data)) {
                            data = newData;
                            
                            // Update team colors
                            const homeTeamName = data.match_info.home_team;
                            const awayTeamName = data.match_info.away_team;
                            
                            const homeTeamKey = Object.keys(teamData).find(key => 
                                teamData[key].name === homeTeamName
                            );
                            const awayTeamKey = Object.keys(teamData).find(key => 
                                teamData[key].name === awayTeamName
                            );
                            
                            if (homeTeamKey) homeTeamColor = teamData[homeTeamKey].color;
                            if (awayTeamKey) awayTeamColor = teamData[awayTeamKey].color;
                            
                            document.documentElement.style.setProperty('--home-color', homeTeamColor);
                            document.documentElement.style.setProperty('--away-color', awayTeamColor);
                            
                            initializeCard();
                            restartAnimations();
                        }
                    }
                } catch (error) {
                    console.error('Error reloading JSON:', error);
                }
            }, 5000);
        }

        // Load JSON on page load
        loadJSON().then(() => {
            // Start auto-reload after initial load
            startAutoReload();
        });

        // Initialize 3D scene
        init3D();

        // Restart animations when page becomes visible (OBS source shown)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                restartAnimations();
            }
        });

        // Also restart on page focus (when OBS refreshes the browser source)
        window.addEventListener('focus', function() {
            restartAnimations();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (animationId) cancelAnimationFrame(animationId);
            if (renderer) renderer.dispose();
        });
    </script>
</body>
</html>
